<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Mouse Cage Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        footer {
            text-align: center;
            color: gray;
            font-size: 0.8rem;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        .rack {
            margin-top: 20px;
        }
        .rack .row {
            margin-bottom: 10px;
        }
        .cage {
            width: 60px;
            height: 60px;
            border: 1px solid #ccc;
            text-align: center;
            vertical-align: middle;
            line-height: 60px;
            cursor: pointer;
            display: inline-block;
        }
        .cage.filled {
            background-color: #f0ad4e;
        }
        .cage.empty {
            background-color: #eee;
        }
        .cage.selected {
            outline: 3px solid #5bc0de;
        }
        .cage-label {
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4">Mouse Cage Management</h1>

        <!-- ユーザー選択 -->
        <form method="get" action="" class="mt-3 mb-3">
            <div class="row">
                <div class="col-md-3">
                    <select name="user" class="form-select" onchange="this.form.submit()">
                        <option value="">All Users</option>
                        {% for user in user_list %}
                            <option value="{{ user }}" {% if selected_user == user %}selected{% endif %}>{{ user }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <select name="rack" class="form-select" onchange="this.form.submit()">
                        {% for rack in rack_names %}
                            <option value="{{ rack }}" {% if current_rack == rack %}selected{% endif %}>Rack {{ rack }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </form>

        <!-- ラック情報の表示 -->
        <div class="rack">
            {% for row in range(1, 6) %}
            <div class="row">
                {% for col in range(1, 6) %}
                {% set cage = cages | selectattr('row', 'equalto', row) | selectattr('col', 'equalto', col) | first %}
                <div class="col">
                    {% if cage %}
                    <a href="{{ url_for('cage_detail', rack=current_rack, row=row, col=col) }}" class="cage filled">
                        <div class="cage-label">{{ cage['cage_id'] }}</div>
                    </a>
                    {% else %}
                    <a href="{{ url_for('cage_detail', rack=current_rack, row=row, col=col) }}" class="cage empty">
                        <div class="cage-label">Empty</div>
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>

        <!-- 統計情報の表示 -->
        <p>Total cages in rack {{ current_rack }}: {{ filled_cages }}</p>
        <p>Total mice in rack {{ current_rack }}: {{ total_mice }}</p>
        <p>Total cages overall: {{ total_filled_cages }}</p>
        <p>Total mice overall: {{ total_mice_all }}</p>

        <!-- フッター -->
        <footer>
            Designed for Wu lab @Houston
        </footer>
    </div>
</body>
</html>
